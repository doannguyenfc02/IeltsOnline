{{!-- resouces/view/Exam/test1.js --}}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bài Kiểm Tra Trắc Nghiệm</title>
  <style>
    /* Thêm độ lệch cho các phần tử input và label */
    .choice {
      margin-left: 10px; /* Điều chỉnh giá trị này để thay đổi độ lệch */
    }

    /* Tùy chỉnh các phần tử label để giữ cùng một dòng với đầu input */
    label {
      display: inline-block;
    }

    /* Thêm một số kiểu khác nếu cần thiết */
    body {
      font-family: Arial, sans-serif;
    }
  </style>
  <script>
    var score = 0;

    function showResults() {
      var totalQuestions = {{questions.length}};
      var correctAnswers = 0;

      {{#each questions}}
        var selectedAnswer = document.querySelector('input[name="question{{@index}}"]:checked');
        if (selectedAnswer) {
          var userAnswer = selectedAnswer.value;
          if (userAnswer === '{{this.correctOption}}') {
            correctAnswers++;
          }
        }
      {{/each}}

      score = correctAnswers;

      // Hiển thị kết quả trong một khu vực khác
      var resultContainer = document.getElementById('result-container');
      var scoreElement = document.getElementById('score');
      resultContainer.style.display = 'block';

      // Hiển thị thông báo với kết quả
      var resultMessage = document.getElementById('result-message');
      if (score === totalQuestions) {
        resultMessage.textContent = 'Chúc mừng! Bạn đã trả lời đúng tất cả câu hỏi.';
      } else {
        resultMessage.textContent = 'Bạn đã trả lời đúng ' + score + '/' + totalQuestions + ' câu hỏi.';
      }

      // Ngăn chặn mặc định của sự kiện submit để tránh refresh trang
      event.preventDefault();
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        var lessonId;
        var deleteForm = document.forms['delete-lesson-form'];
        var btnDeleteLesson = document.getElementById('btn-delete-lesson');

        // When dialog confirm clicked
        $('#delete-lesson-modal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            lessonId = button.data('id');
            console.log(lessonId);
            
        });

        console.log(btnDeleteLesson);

        // When delete lesson btn clicked
        btnDeleteLesson.onclick=function(){
          deleteForm.action= '/exam/' + lessonId + '?_method=DELETE';
          deleteForm.submit();
        }

    });
</script>
</head>
<body>
  <a href="/exam/create">Tạo câu hỏi (test-ẩn sau)</a>
  <a href="/exam/insertfile">Tạo câu hỏi bằng file (test-ẩn sau)</a>
  <h1>Bài Kiểm Tra Trắc Nghiệm</h1>

  <form id="quiz-form">
    {{#each questions}}
      <div>
        <p>Câu hỏi {{sum @index 1}}:{{this.text}}</p>
        <label><input type="radio" name="question{{@index}}" value="a" class="choice"> {{this.options.[0]}}</label><br>
        <label><input type="radio" name="question{{@index}}" value="b" class="choice"> {{this.options.[1]}}</label><br>
        <label><input type="radio" name="question{{@index}}" value="c" class="choice"> {{this.options.[2]}}</label><br>
        <label><input type="radio" name="question{{@index}}" value="d" class="choice"> {{this.options.[3]}}</label><br>
        <a href="/exam/{{this._id}}/edit" class="btn btn-link">Chỉnh Sửa</a>
        <a href="" class="btn btn-link" data-toggle="modal" data-id="{{this._id}}" data-target="#delete-lesson-modal">Xóa</a>
      </div>

    {{/each}}

    <button type="submit" onclick="showResults()">Nộp bài</button>
    <a href="/exam">Làm lại</a>

    <div id="result-container" style="display: none;">
      <h2>Kêt quả:</h2>
      <p id="score"></p>
      <p id="result-message"></p>
    </div>
  </form>

{{!-- Confirm delete lesson --}}
<div id="delete-lesson-modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Xóa Bài giảng?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Bạn chắc chắn muốn xóa Bài giảng này?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
        <button id="btn-delete-lesson" type="button" class="btn btn-danger">Xóa bỏ</button>
      </div>
    </div>
  </div>
</div>
{{!-- Delete hidden form --}}
<form name="delete-lesson-form" method="POST"></form>
</body>
</html>
